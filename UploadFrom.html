from flask import Flask, request, jsonify
import os

app = Flask(__name__)

UPLOAD_FOLDER = "uploads"
os.makedirs(UPLOAD_FOLDER, exist_ok=True)

@app.route("/upload", methods=["POST"])
def upload_video():
    if "file" not in request.files:
        return jsonify({"error": "–§–∞–π–ª –∏—Ä—Å—ç–Ω–≥“Ø–π"}), 400

    file = request.files["file"]
    if file.filename == "":
        return jsonify({"error": "–§–∞–π–ª —Å–æ–Ω–≥–æ–æ–≥“Ø–π –±–∞–π–Ω–∞"}), 400

    filepath = os.path.join(UPLOAD_FOLDER, file.filename)
    file.save(filepath)

    print("üé¨ –í–∏–¥–µ–æ —Ö“Ø–ª—ç—ç–Ω –∞–≤–ª–∞–∞:", filepath)

    # –í–∏–¥–µ–æ –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞–ª—Ç (YOLO) —Ö–∏–π—Ö —Ö—ç—Å—ç–≥ —ç–Ω–¥ –±–∞–π—Ö –±–æ–ª–Ω–æ
    response_data = {
        "message": "–í–∏–¥–µ–æ –∞–º–∂–∏–ª—Ç—Ç–∞–π —Ö“Ø–ª—ç—ç–∂ –∞–≤–ª–∞–∞!",
        "total_cars": 12,
        "free_spots": 3,
        "occupied_spots": [1, 2, 4, 5, 6, 7, 9, 10, 11]
    }

    return jsonify(response_data), 200

if __name__ == "__main__":
    app.run(debug=True, host="0.0.0.0", port=5000)
